#!/bin/bash
set -e

if [[ -z "${1}" || -z "${2}" ]]; then
  echo "usage: maybe_checkout_next_commit parentCommitId sourceLocation" >&2
  exit 1
fi

PARENT_COMMIT=${1}
SOURCE_LOCATION=${2}

cd ${SOURCE_LOCATION}
git pull origin master

NEXT_COMMIT=$(git log --ancestry-path --format=%H ${PARENT_COMMIT}..origin/master | tail -1)

if [[ -z "$NEXT_COMMIT" ]]; then
  echo "No new commit, checking out parent"
  git checkout $PARENT_COMMIT
  exit 0
fi

echo "checking out next ${NEXT_COMMIT}"

git checkout $NEXT_COMMIT